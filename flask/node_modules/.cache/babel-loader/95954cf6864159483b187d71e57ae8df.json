{"ast":null,"code":"import _classCallCheck from\"/mnt/e/MyReact/new_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/mnt/e/MyReact/new_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/mnt/e/MyReact/new_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/mnt/e/MyReact/new_frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import firebase from'firebase/app';import'firebase/messaging';import React,{Component}from'react';import axiosBaseURL from'../axios.js';import{Redirect}from'react-router-dom';import{Toast}from'react-bootstrap';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var firebaseConfig={apiKey:\"AIzaSyCGG2bVOzc9jR_dPhNlTxEn_ZTajkcHVzo\",authDomain:\"know-its-off-jsyg.firebaseapp.com\",projectId:\"know-its-off-jsyg\",storageBucket:\"know-its-off-jsyg.appspot.com\",messagingSenderId:\"1039398438265\",appId:\"1:1039398438265:web:f0e1ae04a1db6c68025ba8\"};firebase.initializeApp(firebaseConfig);var messaging=firebase.messaging();export var getToken=function getToken(setTokenFound){return messaging.getToken({vapidKey:'BHqTAUfRBDJlK88PZlXUl92tdXi_YmKp7HaR0RMHQBp0cXZ9bKxW3m53TN9KAf6WhuuO6ZkhYObb9fNOae85ZAc'}).then(function(currentToken){if(currentToken){console.log('current token for client: ',currentToken);setTokenFound=true;// Track the token -> client mapping, by sending to backend server\n// show on the UI that permission is secured\n}else{console.log('No registration token available. Request permission to generate one.');setTokenFound=false;// shows on the UI that permission is required \n}}).catch(function(err){console.log('An error occurred while retrieving token. ',err);// catch error while creating client token\n});};export var onMessageListener=function onMessageListener(){return new Promise(function(resolve){messaging.onMessage(function(payload){resolve(payload);});});};var Firebase=/*#__PURE__*/function(_Component){_inherits(Firebase,_Component);var _super=_createSuper(Firebase);function Firebase(props){var _this;_classCallCheck(this,Firebase);_this=_super.call(this,props);_this.changeNotification=function(myDevices){console.log(myDevices);var currentDate=new Date();for(var x=0;myDevices.length>x;x++){if(myDevices.device_state===1){if(currentDate-Date.parse(myDevices.timestamp>=1800000)){axios.post('https://fcm.googleapis.com/fcm/send',_this.state.post,{headers:{'content-type':'application/json'}});}}}};_this.state={myDevices:[],setTokenFound:false,show:false,notification:{title:'',body:''},error:false,redirect:null,post:{notification:{title:\"Firebase\",body:\"Firebase is awesome\",click_action:\"http://localhost:3000/\",icon:\"http://url-to-an-icon/icon.png\"},user:\"USER TOKEN\"}};return _this;}_createClass(Firebase,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;axiosBaseURL.get(\"/devices\").then(function(app_result){_this2.setState({myDevices:app_result.data});}).catch(function(error){_this2.setState({error:true});console.log(\"error at get device: \",error.response);});this.changeNotification(this.state.myDevices);}},{key:\"render\",value:function render(){var _this3=this;if(this.state.error){if(this.state.redirect){return/*#__PURE__*/_jsx(Redirect,{to:this.state.redirect});}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"There was an error\"}),/*#__PURE__*/_jsx(\"h3\",{children:this.state.error_response})]});}getToken(this.state.setTokenFound);onMessageListener().then(function(payload){_this3.setState({notification:{title:payload.notification.title,body:payload.notification.body,show:true}});console.log(payload);}).catch(function(err){return console.log('failed: ',err);});return/*#__PURE__*/_jsx(Toast,{onClose:function onClose(){return _this3.setState({show:false});},show:this.state.show,delay:3000,autohide:true,animation:true,style:{position:'absolute',top:20,right:20,minWidth:200}});}}]);return Firebase;}(Component);export{Firebase as default};","map":{"version":3,"sources":["/mnt/e/MyReact/new_frontend/src/components/firebase.js"],"names":["firebase","React","Component","axiosBaseURL","Redirect","Toast","axios","firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","initializeApp","messaging","getToken","setTokenFound","vapidKey","then","currentToken","console","log","catch","err","onMessageListener","Promise","resolve","onMessage","payload","Firebase","props","changeNotification","myDevices","currentDate","Date","x","length","device_state","parse","timestamp","post","state","headers","show","notification","title","body","error","redirect","click_action","icon","user","get","app_result","setState","data","response","error_response","position","top","right","minWidth"],"mappings":"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","sourcesContent":["import firebase from 'firebase/app';\r\nimport 'firebase/messaging';\r\nimport React, {Component} from 'react';\r\nimport axiosBaseURL from '../axios.js';\r\nimport { Redirect } from 'react-router-dom';\r\nimport { Toast } from 'react-bootstrap';\r\nimport axios from 'axios';\r\n\r\n\r\nvar firebaseConfig = {\r\n  apiKey: \"AIzaSyCGG2bVOzc9jR_dPhNlTxEn_ZTajkcHVzo\",\r\n  authDomain: \"know-its-off-jsyg.firebaseapp.com\",\r\n  projectId: \"know-its-off-jsyg\",\r\n  storageBucket: \"know-its-off-jsyg.appspot.com\",\r\n  messagingSenderId: \"1039398438265\",\r\n  appId: \"1:1039398438265:web:f0e1ae04a1db6c68025ba8\"\r\n};\r\n\r\nfirebase.initializeApp(firebaseConfig);\r\n\r\nconst messaging = firebase.messaging();\r\n\r\nexport const getToken = (setTokenFound) => {\r\n  return messaging.getToken({vapidKey: 'BHqTAUfRBDJlK88PZlXUl92tdXi_YmKp7HaR0RMHQBp0cXZ9bKxW3m53TN9KAf6WhuuO6ZkhYObb9fNOae85ZAc'}).then((currentToken) => {\r\n    if (currentToken) {\r\n      console.log('current token for client: ', currentToken);\r\n      setTokenFound = true;\r\n      // Track the token -> client mapping, by sending to backend server\r\n      // show on the UI that permission is secured\r\n    } else {\r\n      console.log('No registration token available. Request permission to generate one.');\r\n      setTokenFound = false;\r\n      // shows on the UI that permission is required \r\n    }\r\n  }).catch((err) => {\r\n    console.log('An error occurred while retrieving token. ', err);\r\n    // catch error while creating client token\r\n  });\r\n}\r\n\r\nexport const onMessageListener = () =>\r\nnew Promise((resolve) => {\r\n  messaging.onMessage((payload) => {\r\n    resolve(payload);\r\n  });\r\n});\r\n\r\nexport default class Firebase extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n    this.state = {\r\n      myDevices: [],\r\n      setTokenFound: false, \r\n      show: false, \r\n      notification: {title: '', body: ''},\r\n      error: false,\r\n      redirect: null,\r\n      post: {\r\n        notification: {\r\n              title: \"Firebase\",\r\n              body: \"Firebase is awesome\",\r\n              click_action: \"http://localhost:3000/\",\r\n              icon: \"http://url-to-an-icon/icon.png\"\r\n          },\r\n        user: \"USER TOKEN\"\r\n      }\r\n    }\r\n  };\r\n\r\n//  Take in an array of devices\r\n//     For each device in array:\r\n//       if device.state == 1:\r\n//         if device.timestamp is 30+ minutes old:\r\n//           send notification\r\n\r\n// Probably should add a cool down timer to prevent constant notifications.\r\n  changeNotification = (myDevices) => {\r\n    console.log(myDevices)\r\n    let currentDate = new Date();\r\n    for(var x = 0; myDevices.length > x; x++){\r\n       if(myDevices.device_state === 1){\r\n        if(currentDate - Date.parse(myDevices.timestamp >= 1800000)){\r\n          axios.post('https://fcm.googleapis.com/fcm/send', this.state.post, { \r\n            headers: {\r\n              'content-type': 'application/json'\r\n            }\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n\r\n  componentDidMount() {\r\n    axiosBaseURL.get(\"/devices\").then( (app_result) => {\r\n        this.setState({\r\n          myDevices: app_result.data,\r\n        })\r\n    })\r\n    .catch( (error) => {\r\n      this.setState({error: true});\r\n      console.log(\"error at get device: \", error.response)\r\n    })\r\n    this.changeNotification(this.state.myDevices);\r\n  }\r\n\r\n  render() {\r\n    if(this.state.error) {\r\n      if(this.state.redirect) {return <Redirect to={this.state.redirect} />}\r\n      return(<div><h3>There was an error</h3><h3>{this.state.error_response}</h3></div>)\r\n    }\r\n    getToken(this.state.setTokenFound);\r\n    onMessageListener().then(payload => {\r\n       this.setState({notification: {title: payload.notification.title, body: payload.notification.body, show: true}})\r\n       console.log(payload);\r\n     }).catch(err => console.log('failed: ', err));\r\n    return(\r\n      <Toast onClose={() => this.setState({show: false})} show={this.state.show} delay={3000} autohide animation style={{\r\n        position: 'absolute',\r\n        top: 20,\r\n        right: 20,\r\n        minWidth: 200}}></Toast>\r\n    )\r\n  }\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}